---
title: "Computer Assignment 1"
author: "Gabriel Lindqvist, Jiahui Li"
date: "`r Sys.Date()`"
output: pdf_document
---
# Exercise1.1
```{r, echo=FALSE}
# Input the data
survey_data <- matrix(c(309, 191, 319, 281), nrow = 2, byrow = TRUE)
rownames(survey_data) <- c("Women", "Men")
colnames(survey_data) <- c("In favor", "Against")
survey_data

women_in_favor <- survey_data[1,1]
men_in_favor <- survey_data[1,2]
women_total <- sum(survey_data[1, ])
men_total <- sum(survey_data[2, ])

# Calculate percentages for women
women_percent_in_favor <- (women_in_favor / women_total) * 100
women_percent_against <- 100 - women_percent_in_favor

# Calculate percentages for men
men_percent_in_favor <- (men_in_favor / men_total) * 100
men_percent_against <- 100 - men_percent_in_favor

# Print results
cat("Women: In favor =", women_percent_in_favor, "%, Against =", women_percent_against, "%\n")
cat("Men: In favor =", men_percent_in_favor, "%, Against =", men_percent_against, "%\n")

```
# Exercise1.2
```{r, echo = FALSE}
# Calculate Pearson's Chi-squared test
chi_squared_result <- chisq.test(survey_data, correct = FALSE)
chi_squared_result
# Calculate expected counts
expected_counts <- chi_squared_result$expected
expected_counts

# Calculate likelihood ratio statistic G^2
observed <- as.vector(survey_data)
expected <- as.vector(expected_counts)
G2 <- 2 * sum(observed * log(observed / expected))
G2

# Print results
cat("Pearson's Chi-squared statistic (X^2):", chi_squared_result$statistic, "\n")
cat("Likelihood ratio statistic (G^2):", G2, "\n")
cat("P-value (from Chi-squared test):", chi_squared_result$p.value, "\n")

# Conclusion
if (chi_squared_result$p.value < 0.05) {
  cat("Conclusion: Reject the null hypothesis. There is a significant association between gender and opinion on legal abortion.\n")
} else {
  cat("Conclusion: Fail to reject the null hypothesis. There is no significant association between gender and opinion on legal abortion.\n")
}

```
# Exercise 1.3
```{r, echo=FALSE}
# Calculate odds for women and men
odds_women <- survey_data[1, 1] / survey_data[1, 2]
odds_men <- survey_data[2, 1] / survey_data[2, 2]

# Odds ratio
odds_ratio <- odds_women / odds_men

# Log odds ratio and its standard error
log_odds_ratio <- log(odds_ratio)
se_log_odds_ratio <- sqrt(1 / survey_data[1, 1] + 1 / survey_data[1, 2] +
                          1 / survey_data[2, 1] + 1 / survey_data[2, 2])

# 95% confidence interval for the log odds ratio
ci_log_lower <- log_odds_ratio - 1.96 * se_log_odds_ratio
ci_log_upper <- log_odds_ratio + 1.96 * se_log_odds_ratio

# Transform back to get the confidence interval for the odds ratio
ci_lower <- exp(ci_log_lower)
ci_upper <- exp(ci_log_upper)

# Print results
cat("Odds for women (In favor / Against):", odds_women, "\n")
cat("Odds for men (In favor / Against):", odds_men, "\n")
cat("Odds Ratio (Women vs Men):", odds_ratio, "\n")
cat("95% Confidence Interval for Odds Ratio: [", ci_lower, ",", ci_upper, "]\n")

# Interpretation
if (1 < ci_lower || 1 > ci_upper) {
  cat("Interpretation: The odds of being in favor of legal abortion significantly differ between women and men.\n")
} else {
  cat("Interpretation: The odds of being in favor of legal abortion do not significantly differ between women and men.\n")
}
```

1. **Odds Calculation**: The odds for women and men are calculated as \( \text{In favor} / \text{Against} \) for each group.
2. **Odds Ratio**: The odds ratio is the ratio of the odds for women to the odds for men.
3. **Confidence Interval**: 
   - The log of the odds ratio is used to calculate the confidence interval, as the log odds follow a normal distribution.
   - The standard error of the log odds ratio is computed using the formula \( \sqrt{1/a + 1/b + 1/c + 1/d} \), where \( a, b, c, d \) are the cell counts.
   - The confidence interval is transformed back to the odds ratio scale.
4. **Interpretation**: Based on the confidence interval, it is concluded whether the odds differ significantly between the two groups.

# Exercise1.4
```{r,echo=FALSE}
# Calculate risks (probabilities of being in favor)
risk_women <- survey_data[1, 1] / women_total
risk_men <- survey_data[2, 1] / men_total

# Risk ratio
risk_ratio <- risk_women / risk_men

# Log risk ratio and its standard error
log_risk_ratio <- log(risk_ratio)
se_log_risk_ratio <- sqrt((1 / survey_data[1, 1]) - (1 / women_total) +
                          (1 / survey_data[2, 1]) - (1 / men_total))

# 95% confidence interval for the log risk ratio
ci_log_lower <- log_risk_ratio - 1.96 * se_log_risk_ratio
ci_log_upper <- log_risk_ratio + 1.96 * se_log_risk_ratio

# Transform back to get the confidence interval for the risk ratio
ci_lower <- exp(ci_log_lower)
ci_upper <- exp(ci_log_upper)

# Print results
cat("Risk for women (In favor / Total):", risk_women, "\n")
cat("Risk for men (In favor / Total):", risk_men, "\n")
cat("Risk Ratio (Women vs Men):", risk_ratio, "\n")
cat("95% Confidence Interval for Risk Ratio: [", ci_lower, ",", ci_upper, "]\n")

# Interpretation
if (1 < ci_lower || 1 > ci_upper) {
  cat("Interpretation: The relative risk of being in favor of legal abortion significantly differs between women and men.\n")
} else {
  cat("Interpretation: The relative risk of being in favor of legal abortion does not significantly differ between women and men.\n")
}
```
### Why Do the Results Differ?
- **Odds Ratio vs Risk Ratio**:
  - Odds Ratio compares the relative odds (favor vs oppose), focusing on the ratio of proportions within each group.
  - Risk Ratio compares the direct probabilities (favor/total), reflecting absolute differences between groups.

- **Sensitivity to Data Range**:
  - When the probabilities (risks) are above 50%, the odds tend to exaggerate differences compared to the risk. In this case, women (61.8%) and men (67.6%) have relatively high probabilities, making OR and RR diverge.

---
### Conclusion:
- If the research question focuses on **relative tendencies or odds**, **Odds Ratio** is appropriate, suggesting that women are more inclined to favor legal abortion.
- If the focus is on **absolute differences in proportions**, **Risk Ratio** is more intuitive, showing no significant difference between women and men.
