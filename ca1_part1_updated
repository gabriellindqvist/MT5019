---
title: "Computer Assignment 1"
author: "Gabriel Lindqvist, Jiahui Li"
date: "`r Sys.Date()`"
output: pdf_document
---

# Exercise1.1
```{r, echo=FALSE}
survey_data<- as.table(rbind(c(309, 191), c(319, 281)))
dimnames(survey_data) <- list(gender = c("women", "men"),opinion = c("favor","against"))

women_in_favor <- survey_data[1,1]
men_in_favor <- survey_data[1,2]
women_total <- sum(survey_data[1, ])
men_total <- sum(survey_data[2, ])

# Calculate percentages for women
women_percent_in_favor <- (women_in_favor / women_total) * 100
women_percent_against <- 100 - women_percent_in_favor

# Calculate percentages for men
men_percent_in_favor <- (men_in_favor / men_total) * 100
men_percent_against <- 100 - men_percent_in_favor

# Print results
cat("Women: In favor =", women_percent_in_favor, "%, Against =", women_percent_against, "%\n")
cat("Men: In favor =", men_percent_in_favor, "%, Against =", men_percent_against, "%\n")

```
# Exercise1.2
```{r, echo = FALSE}
# Calculate Pearson's Chi-squared test
chi_squared_result <- chisq.test(survey_data, correct = FALSE)
chi_squared_result
# Calculate expected counts
expected_counts <- chi_squared_result$expected
expected_counts

# Calculate likelihood ratio statistic G^2
observed <- as.vector(survey_data)
expected <- as.vector(expected_counts)
G2 <- 2 * sum(observed * log(observed / expected))

# Print results
cat("Pearson's Chi-squared statistic (X^2):", chi_squared_result$statistic, "\n")
cat("Likelihood ratio statistic (G^2):", G2, "\n")
cat("P-value (from Chi-squared test):", chi_squared_result$p.value, "\n")

# Conclusion
if (chi_squared_result$p.value < 0.05) {
  cat("Conclusion: Reject the null hypothesis. There is a significant association between gender and opinion on legal abortion.\n")
} else {
  cat("Conclusion: Fail to reject the null hypothesis. There is no significant association between gender and opinion on legal abortion.\n")
}

```
# Exercise 1.3
```{r, echo=FALSE}
# Calculate odds for women and men
odds_women <- survey_data[1, 1] / survey_data[1, 2]
odds_men <- survey_data[2, 1] / survey_data[2, 2]

# Odds ratio
odds_ratio <- odds_women / odds_men

# Log odds ratio and its standard error
log_odds_ratio <- log(odds_ratio)
se_log_odds_ratio <- sqrt(1 / survey_data[1, 1] + 1 / survey_data[1, 2] +
                          1 / survey_data[2, 1] + 1 / survey_data[2, 2])

# 95% confidence interval for the log odds ratio
ci_log_lower <- log_odds_ratio - 1.96 * se_log_odds_ratio
ci_log_upper <- log_odds_ratio + 1.96 * se_log_odds_ratio

# Transform back to get the confidence interval for the odds ratio
ci_lower <- exp(ci_log_lower)
ci_upper <- exp(ci_log_upper)

# Print results
cat("Odds for women (In favor / Against):", odds_women, "\n")
cat("Odds for men (In favor / Against):", odds_men, "\n")
cat("Odds Ratio (Women vs Men):", odds_ratio, "\n")
cat("95% Confidence Interval for Odds Ratio: [", ci_lower, ",", ci_upper, "]\n")

# Interpretation
if (1 < ci_lower || 1 > ci_upper) {
  cat("Interpretation: The odds of being in favor of legal abortion significantly differ between women and men.\n")
} else {
  cat("Interpretation: The odds of being in favor of legal abortion do not significantly differ between women and men.\n")
}
```
# Exercise1.4
```{r,echo=FALSE}
# Calculate risks (probabilities of being in favor)
risk_women <- survey_data[1, 1] / women_total
risk_men <- survey_data[2, 1] / men_total

# Risk ratio
risk_ratio <- risk_women / risk_men

# Log risk ratio and its standard error
log_risk_ratio <- log(risk_ratio)
se_log_risk_ratio <- sqrt((1 / survey_data[1, 1]) - (1 / women_total) +
                          (1 / survey_data[2, 1]) - (1 / men_total))

# 95% confidence interval for the log risk ratio
ci_log_lower <- log_risk_ratio - 1.96 * se_log_risk_ratio
ci_log_upper <- log_risk_ratio + 1.96 * se_log_risk_ratio

# Transform back to get the confidence interval for the risk ratio
ci_lower <- exp(ci_log_lower)
ci_upper <- exp(ci_log_upper)

# Print results
cat("Risk for women (In favor / Total):", risk_women, "\n")
cat("Risk for men (In favor / Total):", risk_men, "\n")
cat("Risk Ratio (Women vs Men):", risk_ratio, "\n")
cat("95% Confidence Interval for Risk Ratio: [", ci_lower, ",", ci_upper, "]\n")

# Interpretation
if (1 < ci_lower || 1 > ci_upper) {
  cat("Interpretation: The relative risk of being in favor of legal abortion significantly differs between women and men.\n")
} else {
  cat("Interpretation: The relative risk of being in favor of legal abortion does not significantly differ between women and men.\n")
}
```
# Exercise1.5
## Run the code given by the file to address Q1-4
```{r}
#Generate a frequency table and calculate row percentage
tab1<- as.table(rbind(c(309, 191), c(319, 281)))
dimnames(tab1) <- list(gender = c("women", "men"),opinion = c("favor","against"))
addmargins(tab1)
addmargins(prop.table(tab1,1),2)

#Calculate X2, G2 and p-values
chisq.test(tab1,correct=FALSE)
library(MASS) 
loglm(~gender+opinion,tab1)
```
```{r}
#Calculate risk/odds ratio and confidence interval
library(epitools) 
oddsratio(tab1, method = "wald", rev="neither")
riskratio(tab1,rev="neither")
```
The above results using functions are the same as the results generated from the basic code.




